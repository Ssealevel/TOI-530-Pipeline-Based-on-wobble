# TOI-530 Pipeline Based on wobble

This pipeline is designed to process the spectra of TOI-530 from CFHT SPIRou to get the radial velocities of TOI-530.
This pipeline uses the package wobble: https://github.com/megbedell/wobble. You should install wobble before using this pipeline.
Briefly, you should first preprocess the data to get a file named `pre_data.hdf5`.
Then you can process this file to get the radial velocity results and some other results.

## Preprocess
You can run the script `preprocess.py` in `preprocess` with Python to get a hdf5 file `pre_data.hdf5`. 
The original data from SPIRou should in `preprocess/t_files_toi530` when the script is runned by default.
This script needs package `AFS.R ` from https://github.com/xinxuyale/AFS. 
It should be in `preprocess/R_functions` when the script is runned by default.

## Process
You can get final results by putting `pre_data.hdf5` in the same folder of `use_wobble.hdf5` and running `use_wobble.hdf5`.
It will output radial velocity results in a .txt file and a picture of the results. 
Besides, it will output the radial velocities obtained by each order of the spectra in the folder `RV_results_each_order`
and the spectra fitting results of each order in the folder `spe_results_plots`.

### Tune numbers of iteration and learn rates
When running wobble, you need to choose suitable numbers of iteration and learn rates so that the results can converge.
How we tuned these paramters was similar to the script in the wobble: https://github.com/megbedell/wobble/blob/master/notebooks/troubleshooting-optimization.ipynb. The parameters we finally used can be seen in `use_wobble.hdf5`.

### Tune Regularization Parameters
A set of optimized regularization parameters is important when running wobble. 
In our script, the regularization parameters we used is `regularization_file/default_star.hdf5`.
This set of parameters are the default values in wobble.
This parameters file was generated by the fuction "generate_regularization_file" from the script 
https://github.com/megbedell/wobble/blob/master/wobble/regularization/regularization.py.
